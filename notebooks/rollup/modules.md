# Modules

## Bundle Creation

* firstly, the bundle is created
  * contains only the _necessary_ code ❓

* the `Graph` is created
  * holds the `acorn parser`
  * holds the `PluginDriver` - entity
  * holds the `Global Scope`
  * what's its main role ❓
  * by default it includes these acorn plugins
    ```ts
    acornPluginsToInject.push(
			injectImportMeta, // `import.meta`
			injectExportNsFrom, // `export * from`
			injectClassFields, // `class Foo { prop = 'prop'; #privateProp = 'privateProp' }`
			injectStaticClassFeatures // class Foo { static prop = '123' }
		);
    ```
  * the `ModuleLoader` is created
    * responsible for properly loading a module(e.g fetching its dependencies)
    * calling certain hooks - `load`, `resolveId`
    * `getHasModuleSideEffects` ? 
  
* **build phase**
  * 

## Loading modules

* after the file has been read
  * the first `AST` is generated by the `acorn parser`
  * this `AST` is then analyzed; rollup creates a new `AST` based on the one generated by `acorn`;
   
    this is useful as each node holds important logic(e.g: `ImportDeclaration`);
    each node of rollup's `AST` corresponds to a node of `acorn`'s `AST`

    each rollup node holds a reference to the current module that's being fetched:
    ```ts
    this.astContext = { /* ... */ }
    ```


* resolving dependencies: `resolvedIds`

## Internal Modules

## External Modules

## Other relevant entities

### Graph

### ModuleLoader

* held by: `Graph`
* holds the **global scope**

### Module

* holds a scope: `ModuleScope`(child scope); it has a local `this`
  * a new variable is added when a `module scope` is created

### Variable

* what is a `declarator`

### AST node

* has a ref to its `parent`, the module's scope(`child scope`)

## To Try

* multiple inputs
* `-i` option; 
* `InputOptions.{perf, cache.{modules, plugins}, experimentalCacheExpiry, shimMissingExports, context, moduleContext, preserveSymlinks}`
* `InputOptions.preserveModules` -  Preserve module's structure - not hoisting transitive dependencies
* `InputOptions.strictDeprecations` - make errors out of warnings
* `InputOptions.{acornInjectPlugins, acorn}` - custom options for `acorn`
* `markPureCallExpressions`